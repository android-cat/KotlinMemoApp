# アプリフロー - Kotlin Memo App

## ユーザージャーニー

```
┌─────────────────────────────────────────────────────────────┐
│                        アプリ起動                            │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────┐
│                     MainActivity                             │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  [SearchView - メモを検索]                              │ │
│  └────────────────────────────────────────────────────────┘ │
│  ┌──────────────────┬─────────────────────────────────────┐ │
│  │   すべてのメモ    │      フォルダ                       │ │
│  └──────────────────┴─────────────────────────────────────┘ │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  ┌──────────────────────────────────────────────┐     │ │
│  │  │  メモ 1                                        │     │ │
│  │  │  タイトル: Meeting Notes                       │     │ │
│  │  │  内容: Discussed project timeline...           │     │ │
│  │  │  [フォルダバッジ] 2024/01/15                   │     │ │
│  │  └──────────────────────────────────────────────┘     │ │
│  │  ┌──────────────────────────────────────────────┐     │ │
│  │  │  メモ 2                                        │     │ │
│  │  │  タイトル: Shopping List                       │     │ │
│  │  │  内容: Milk, Eggs, Bread...                    │     │ │
│  │  └──────────────────────────────────────────────┘     │ │
│  └────────────────────────────────────────────────────────┘ │
│                                        [+] FAB（新規）      │
└──────────────────────┬──────────────────┬───────────────────┘
                       │                  │
        ┌──────────────┘                  └──────────────┐
        │ メモを選択                         FAB を押す     │
        ▼                                                 ▼
┌─────────────────────────────────┐    ┌─────────────────────────────────┐
│   MemoEditActivity（編集）        │    │   MemoEditActivity（新規）       │
│  ┌────────────────────────────┐ │    │  ┌────────────────────────────┐ │
│  │ タイトル: [Meeting Notes]    │ │    │  │ タイトル: [空欄]           │ │
│  └────────────────────────────┘ │    │  └────────────────────────────┘ │
│  ┌────────────────────────────┐ │    │  ┌────────────────────────────┐ │
│  │ 内容:                      │ │    │  │ 内容:                      │ │
│  │ [複数行テキスト...]         │ │    │  │ [空欄]                     │ │
│  │                            │ │    │  │                            │ │
│  └────────────────────────────┘ │    │  └────────────────────────────┘ │
│  フォルダ選択: [▼ ドロップダウン]   │    │  フォルダ選択: [▼ ドロップダウン]   │
│                                  │    │                                  │
│  [保存ボタン] [削除ボタン]         │    │  [保存ボタン]                     │
└──────────────────────────────────┘    └──────────────────────────────────┘
        │                                         │
        │ 保存                                    │ 保存
        ▼                                         ▼
┌─────────────────────────────────────────────────────────────┐
│              Room Database（SQLite）                          │
│  ┌────────────────┐         ┌──────────────────────┐       │
│  │  memos テーブル │────────▶│   folders テーブル    │       │
│  │  - id           │  FK     │   - id               │       │
│  │  - title        │         │   - name             │       │
│  │  - content      │         │   - createdAt        │       │
│  │  - folderId     │         └──────────────────────┘       │
│  │  - createdAt    │                                         │
│  │  - updatedAt    │                                         │
│  └────────────────┘                                         │
└─────────────────────────────────────────────────────────────┘
```

## フォルダタブのフロー

```
┌─────────────────────────────────────────────────────────────┐
│                    フォルダ タブ                             │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  ┌─────────────────────────────────────────────┐      │ │
│  │  │  Work     [編集 ✏️] [削除 🗑️]                │      │ │
│  │  └─────────────────────────────────────────────┘      │ │
│  │  ┌─────────────────────────────────────────────┐      │ │
│  │  │  Personal [編集 ✏️] [削除 🗑️]                │      │ │
│  │  └─────────────────────────────────────────────┘      │ │
│  │  ┌─────────────────────────────────────────────┐      │ │
│  │  │  Shopping [編集 ✏️] [削除 🗑️]                │      │ │
│  │  └─────────────────────────────────────────────┘      │ │
│  └────────────────────────────────────────────────────────┘ │
│                                        [+] FAB（新規）      │
└──────────────────────┬──────────────────┬───────────────────┘
                       │                  │
        ┌──────────────┘                  └──────────────┐
        │ 編集を押す                        FAB／新規作成を押す │
        ▼                                                 ▼
┌─────────────────────┐                  ┌─────────────────────┐
│  フォルダ編集ダイアログ │                │  新規フォルダダイアログ │
│  ┌────────────────┐ │                  │  ┌────────────────┐ │
│  │ フォルダ名:     │ │                  │  │ フォルダ名:     │ │
│  │ [Work]         │ │                  │  │ [空欄]          │ │
│  └────────────────┘ │                  │  └────────────────┘ │
│  [保存] [キャンセル]   │                  │  [保存] [キャンセル]   │
└─────────────────────┘                  └─────────────────────┘
```

## 検索フロー

```
┌─────────────────────────────────────────────────────────────┐
│                     MainActivity                             │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  SearchView: "meeting"                                 │ │
│  └────────────────────────────────────────────────────────┘ │
│         │                                                    │
│         │ ユーザーが入力                                      │
│         ▼                                                    │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  Room Database に対するリアルタイム検索                  │ │
│  │  SELECT * FROM memos                                   │ │
│  │  WHERE title LIKE '%meeting%'                          │ │
│  │  OR content LIKE '%meeting%'                           │ │
│  └────────────────────────────────────────────────────────┘ │
│         │                                                    │
│         │ LiveData が更新                                     │
│         ▼                                                    │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  フィルタ済み結果:                                      │ │
│  │  ┌──────────────────────────────────────────────┐     │ │
│  │  │  Meeting Notes                               │     │ │
│  │  │  Discussed project timeline...               │     │ │
│  │  └──────────────────────────────────────────────┘     │ │
│  │  ┌──────────────────────────────────────────────┐     │ │
│  │  │  Team Meeting Agenda                         │     │ │
│  │  │  1. Status updates 2. Next steps...          │     │ │
│  │  └──────────────────────────────────────────────┘     │ │
│  └────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## データフローアーキテクチャ

```
┌──────────────────────────────────────────────────────────────┐
│                         UI 層                                │
│  ┌────────────┐  ┌──────────────┐  ┌─────────────────┐      │
│  │ MainActivity│  │MemoEditActivity│ │ FolderActivity  │      │
│  └──────┬─────┘  └──────┬───────┘  └────────┬────────┘      │
│         │                │                    │                │
│         │ observe()      │ observe()          │ observe()      │
│         ▼                ▼                    ▼                │
└─────────┼────────────────┼────────────────────┼───────────────┘
          │                │                    │
┌─────────┼────────────────┼────────────────────┼───────────────┐
│         │         ViewModel 層                    │                │
│  ┌──────▼──────┐                    ┌─────────▼───────┐       │
│  │ MemoViewModel│                    │ FolderViewModel │       │
│  │              │                    │                 │       │
│  │ - allMemos   │                    │ - allFolders    │       │
│  │ - insert()   │                    │ - insert()      │       │
│  │ - update()   │                    │ - update()      │       │
│  │ - delete()   │                    │ - delete()      │       │
│  │ - search()   │                    └─────────┬───────┘       │
│  └──────┬───────┘                              │               │
│         │                                      │               │
└─────────┼──────────────────────────────────────┼───────────────┘
          │                                      │
┌─────────┼──────────────────────────────────────┼───────────────┐
│         │        Repository 層                   │                │
│  ┌──────▼───────┐                    ┌─────────▼────────┐      │
│  │MemoRepository│                    │ FolderRepository │      │
│  │              │                    │                  │      │
│  │ データソースを抽象化             │                    │  データソースを抽象化 │
│  └──────┬───────┘                    └─────────┬────────┘      │
│         │                                      │               │
└─────────┼──────────────────────────────────────┼───────────────┘
          │                                      │
┌─────────┼──────────────────────────────────────┼───────────────┐
│         │          DAO 層                        │                │
│  ┌──────▼───┐                        ┌─────────▼─────┐         │
│  │ MemoDao  │                        │  FolderDao    │         │
│  │          │                        │               │         │
│  │ @Query   │                        │  @Query       │         │
│  │ @Insert  │                        │  @Insert      │         │
│  │ @Update  │                        │  @Update      │         │
│  │ @Delete  │                        │  @Delete      │         │
│  └──────┬───┘                        └───────┬───────┘         │
│         │                                    │                 │
└─────────┼────────────────────────────────────┼─────────────────┘
          │                                    │
          └──────────┬─────────────────────────┘
                     │
┌────────────────────▼──────────────────────────────────────────┐
│                    Room Database                               │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │                    SQLite ストレージ                      │ │
│  │  ┌─────────────┐              ┌──────────────┐          │ │
│  │  │ memos       │──────────────│  folders     │          │ │
│  │  │ テーブル     │   外部キー   │  テーブル    │          │ │
│  │  └─────────────┘              └──────────────┘          │ │
│  └──────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────┘
```

## 主要なユーザー操作

### 1. 新しいメモを作成する
1. ユーザーが MainActivity を開く
2. メモタブの FAB（＋）を押す
3. 空のフィールドで MemoEditActivity が開く
4. タイトルと内容を入力する
5. 任意でドロップダウンからフォルダを選択する
6. 保存ボタンを押す
7. MemoViewModel.insert() が呼ばれる
8. Room Database にメモが永続化される
9. LiveData が自動的に更新される
10. 更新されたリストとともに MainActivity に戻る

### 2. メモを検索する
1. ユーザーが SearchView に入力する
2. Room Database に対するリアルタイムクエリが実行される
3. タイトルおよび内容に対する SQL の LIKE クエリ
4. LiveData がフィルタ済み結果を発行する
5. RecyclerView が即時に更新される
6. 検索条件に一致するメモのみ表示される

### 3. フォルダで整理する
1. フォルダタブに切り替える
2. FAB を押して新しいフォルダを作成する
3. ダイアログにフォルダ名を入力する
4. フォルダがデータベースに保存される
5. メモ編集時にドロップダウンでフォルダを選択する
6. メモは外部キーでフォルダと関連付けられる
7. カスケード削除：フォルダ削除で含まれるメモが削除される

### 4. 編集／削除
1. メモカードをタップする
2. MemoEditActivity がフィールドを埋めた状態で開く
3. タイトル／内容／フォルダを編集する
4. 保存で既存メモが ID によって更新される
5. または削除ボタンを押して確認ダイアログを表示する
6. 削除されたメモはデータベースから取り除かれる
7. LiveData によって UI が自動更新される
